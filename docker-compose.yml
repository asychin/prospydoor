services:

  ppch:
    build: .
    container_name: ${PPCH_CONTAINER_NAME:-ppch}
    restart: ${PPCH_RESTART_POLICY:-unless-stopped}
    ports:
      - '${PPCH_PORT:-8890}:8000'
    environment:
      - API_KEY=${PPCH_API_KEY}
      - PROSODY_URL=${PROSODY_URL:-http://docker-jitsi-meet-prosody-1:5280}
      - MUC_DOMAIN=${MUC_DOMAIN:-muc.meet.yourdomain.com}
      - DEBUG=${DEBUG:-false}
      - TZ=${TZ:-UTC}
    networks:
      - ${PPCH_NETWORK_INTERNAL:-jitsi}
    healthcheck:
      test: ["CMD", "python", "-c", "import httpx; httpx.get('http://localhost:8000/health', timeout=5.0)"]
      interval: ${PPCH_HEALTHCHECK_INTERVAL:-30s}
      timeout: ${PPCH_HEALTHCHECK_TIMEOUT:-5s}
      retries: ${PPCH_HEALTHCHECK_RETRIES:-3}
      start_period: ${PPCH_HEALTHCHECK_START_PERIOD:-10s}
    labels:
      service: "ppch"
      description: "Prosody Participant Count Hook API"

networks:
  jitsi:
    external: true
    name: ${PPCH_NETWORK_EXTERNAL:-jitsi_meet.jitsi}

